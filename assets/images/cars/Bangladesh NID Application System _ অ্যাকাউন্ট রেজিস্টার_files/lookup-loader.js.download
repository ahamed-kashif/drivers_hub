(function(globalScope, $) {

    var path = globalScope.contextPath + "/citizen-home/lookup";

    function populateElements(els, json) {
        var html = '';
        for (var key in json) {
            if (json.hasOwnProperty(key)) {
                html += '<option value="' + key + '">' + json[key] + '</option>'
            }
        }
        $(els).append(html);
    }

    function removeElements(els) {
        $(els).find("option:gt(0)").remove();
    }

    function resetElements(els) {
        $(els).val("");
    }

    function hideElements(els) {
        $(els).hide();
    }

    //public interface
    globalScope.lookupLoader = {
        load: function(options) {
            var data = new FormData();
            for (var key in options.filter) {
                if(options.filter.hasOwnProperty(key)) {
                    data.append(key, options.filter[key]);
                }
            }
            if(typeof options.path !== "undefined") {
                path = options.path;
            }
            var defer = $.ajax({
                type: 'POST',
                url: path + "/" + options.resource,
                data: data,
                dataType: 'text',
                processData: false,
                contentType: false
            });
            defer.done(function(response) {
                var errorMessageElement = $("#error-block");
                var resp = JSON.parse(response);
                resetElements(options.reset);
                removeElements(options.target);
                removeElements(options.remove);
                hideElements(options.hide);
                if(resp.status === "ERROR") {
                    errorMessageElement.addClass("error").show()
                        .find("ul > li").text(resp.error.message);
                    return;
                }
                //expecting success here
                errorMessageElement.hide().find("ul > li").text("");
                populateElements(options.target, resp);
                if(typeof options.done !== 'undefined') {
                    options.done();
                }
            });
        }
    }
})(window, jQuery);